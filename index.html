<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* This should now work */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        /* Custom scrollbar for chat messages */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4"> <div class="bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col h-[600px] overflow-hidden">
        <div class="bg-blue-600 text-white p-4 rounded-t-xl flex items-center justify-between shadow-md">
            <h1 class="text-xl font-semibold">SHADOW INSURE BOT</h1>
            <div id="bot-status" class="flex items-center space-x-2">
                <span class="relative flex h-3 w-3">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </span>
                <span class="text-sm">Online</span>
            </div>
        </div>

        <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 chat-messages">
            <div class="flex justify-start">
                <div class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-[75%] shadow-sm">
                    <p>Hello! I'm your InsureBot. How can I assist you with your insurance queries today?</p>
                </div>
            </div>
        </div>

        <div id="loading-indicator" class="hidden flex justify-start p-4 pt-0">
            <div class="bg-blue-100 text-blue-800 p-3 rounded-lg max-w-[75%] shadow-sm flex items-center space-x-2">
                <div class="dot-flashing"></div>
                <span class="text-sm">Bot is typing...</span>
            </div>
        </div>

        <div class="p-4 bg-gray-50 border-t border-gray-200 flex items-center space-x-3 rounded-b-xl">
            <button id="microphone-btn" class="p-3 bg-red-500 text-white rounded-full shadow-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                    <path d="M8.25 4.5a3.75 3.75 0 1 1 7.5 0v8.25a3.75 3.75 0 1 1-7.5 0V4.5Z" />
                    <path d="M15.75 17.25v-4.5a.75.75 0 0 1 1.5 0v4.5a6 6 0 0 1-12 0v-4.5a.75.75 0 0 1 1.5 0v4.5a4.5 4.5 0 0 0 9 0ZM12.75 20.25a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75Z" />
                </svg>
            </button>
            <input type="text" id="user-input" placeholder="Type your message or speak..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
            <button id="send-btn" class="p-3 bg-blue-500 text-white rounded-lg shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                    <path d="M3.478 2.405a.75.75 0 0 0-.926.94l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.405Z" />
                </svg>
            </button>
        </div>
    </div>

    <div id="message-box" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="message-box-text" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="message-box-ok-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">OK</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const microphoneBtn = document.getElementById('microphone-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const botStatus = document.getElementById('bot-status');
        const messageBox = document.getElementById('message-box');
        const messageBoxText = document.getElementById('message-box-text');
        const messageBoxOkBtn = document.getElementById('message-box-ok-btn');

        // Web Speech API variables
        let recognition;
        let isListening = false;
        const synth = window.speechSynthesis;

        // Function to show custom message box
        function showMessageBox(message) {
            messageBoxText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        // Event listener for message box OK button
        messageBoxOkBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // Initialize Speech Recognition
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = false; // Listen for a single utterance
            recognition.interimResults = false; // Only return final results
            recognition.lang = 'en-US'; // Set language

            recognition.onstart = () => {
                isListening = true;
                microphoneBtn.classList.add('bg-green-500', 'animate-pulse'); // Indicate listening
                microphoneBtn.classList.remove('bg-red-500');
                botStatus.innerHTML = `
                    <span class="relative flex h-3 w-3">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-orange-500"></span>
                    </span>
                    <span class="text-sm">Listening...</span>
                `;
                console.log('Speech recognition started');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                console.log('Transcript:', transcript);
                userInput.value = transcript; // Put transcript in input field
                processUserInput(transcript);
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                showMessageBox(`Speech recognition error: ${event.error}. Please try again.`);
                stopListening();
            };

            recognition.onend = () => {
                stopListening();
                console.log('Speech recognition ended');
            };
        } else {
            microphoneBtn.disabled = true;
            microphoneBtn.classList.add('opacity-50', 'cursor-not-allowed');
            showMessageBox('Speech Recognition is not supported in this browser. Please use Chrome or Edge for voice input.');
        }

        // Function to start listening
        function startListening() {
            if (recognition && !isListening) {
                try {
                    recognition.start();
                } catch (e) {
                    console.error('Error starting recognition:', e);
                    showMessageBox('Could not start microphone. Please ensure microphone permissions are granted.');
                    stopListening();
                }
            }
        }

        // Function to stop listening
        function stopListening() {
            if (recognition && isListening) {
                recognition.stop();
                isListening = false;
                microphoneBtn.classList.remove('bg-green-500', 'animate-pulse');
                microphoneBtn.classList.add('bg-red-500');
                botStatus.innerHTML = `
                    <span class="relative flex h-3 w-3">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                    </span>
                    <span class="text-sm">Online</span>
                `;
            }
        }

        // Microphone button click handler
        microphoneBtn.addEventListener('click', () => {
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        });

        // Send button click handler
        sendBtn.addEventListener('click', () => {
            const message = userInput.value.trim();
            if (message) {
                processUserInput(message);
                stopListening(); // Stop listening if user types and sends
            }
        });

        // Allow sending message with Enter key
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });

        // Function to add a message to the chat display
        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', sender === 'user' ? 'justify-end' : 'justify-start');

            const messageBubble = document.createElement('div');
            messageBubble.classList.add(
                'p-3',
                'rounded-lg',
                'max-w-[75%]',
                'shadow-sm'
            );
            // Corrected: Add classes individually
            if (sender === 'user') {
                messageBubble.classList.add('bg-blue-500', 'text-white');
            } else {
                messageBubble.classList.add('bg-gray-200', 'text-gray-800');
            }
            messageBubble.textContent = text;
            messageDiv.appendChild(messageBubble);
            chatMessages.appendChild(messageDiv);

            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to simulate bot response
        async function getBotResponse(userMessage) {
            const lowerCaseMessage = userMessage.toLowerCase();
            let response = "I'm sorry, I don't have information on that specific query yet. Can you please rephrase or ask about common insurance topics?";

            if (lowerCaseMessage.includes("hello") || lowerCaseMessage.includes("hi")) {
                response = "Hello there! How can I help you with your insurance needs today?";
            } else if (lowerCaseMessage.includes("policy")) {
                response = "Are you looking for information on life insurance, health insurance, or general insurance policies?";
            } else if (lowerCaseMessage.includes("claim")) {
                response = "To assist with claims, please tell me the type of insurance and your policy number.";
            } else if (lowerCaseMessage.includes("health insurance")) {
                response = "Health insurance policies cover medical expenses. Do you want to know about coverage, premiums, or claims process?";
            } else if (lowerCaseMessage.includes("life insurance")) {
                response = "Life insurance provides financial security for your loved ones. What specific information are you looking for?";
            } else if (lowerCaseMessage.includes("quote") || lowerCaseMessage.includes("price")) {
                response = "I can help you with a quote. What type of insurance are you interested in?";
            } else if (lowerCaseMessage.includes("thank you") || lowerCaseMessage.includes("thanks")) {
                response = "You're welcome! Is there anything else I can assist you with?";
            } else if (lowerCaseMessage.includes("bye") || lowerCaseMessage.includes("goodbye")) {
                response = "Goodbye! Have a great day. Feel free to reach out if you have more questions.";
            }
            // Add more sophisticated responses here for the hackathon!
            // For the hackathon, this is where you would integrate LLM calls or a more advanced knowledge retrieval system.

            return new Promise(resolve => {
                setTimeout(() => resolve(response), 1000); // Simulate network delay
            });
        }

        // Function to make the bot speak
        function speak(text) {
            if (synth.speaking) {
                console.log('SpeechSynthesisUtterance.speaking');
                return;
            }
            if (text !== '') {
                const utterThis = new SpeechSynthesisUtterance(text);
                utterThis.onend = function (event) {
                    console.log('SpeechSynthesisUtterance.onend');
                    // Hide loading indicator and set status back to online after speaking
                    loadingIndicator.classList.add('hidden');
                    botStatus.innerHTML = `
                        <span class="relative flex h-3 w-3">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                        </span>
                        <span class="text-sm">Online</span>
                    `;
                };
                utterThis.onerror = function (event) {
                    console.error('SpeechSynthesisUtterance.onerror', event);
                    showMessageBox('Error speaking response. Your browser might not support Text-to-Speech or there was an issue with the voice.');
                    loadingIndicator.classList.add('hidden');
                    botStatus.innerHTML = `
                        <span class="relative flex h-3 w-3">
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                        </span>
                        <span class="text-sm text-red-600">Error</span>
                    `;
                };
                synth.speak(utterThis);
            } else {
                // If no text to speak, just hide loading and set status
                loadingIndicator.classList.add('hidden');
                botStatus.innerHTML = `
                    <span class="relative flex h-3 w-3">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                    </span>
                    <span class="text-sm">Online</span>
                `;
            }
        }

        // Main function to process user input
        async function processUserInput(message) {
            addMessage('user', message);
            userInput.value = ''; // Clear input field

            // Show loading indicator
            loadingIndicator.classList.remove('hidden');
            botStatus.innerHTML = `
                <span class="relative flex h-3 w-3">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                </span>
                <span class="text-sm">Thinking...</span>
            `;

            const botResponse = await getBotResponse(message);
            addMessage('bot', botResponse);
            speak(botResponse);
        }

        // Basic dot-flashing animation for loading indicator
        const style = document.createElement('style');
        style.innerHTML = `
            .dot-flashing {
                position: relative;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: #3b82f6; /* Tailwind blue-500 */
                color: #3b82f6;
                animation: dotFlashing 1s infinite alternate;
                animation-delay: 0s;
            }
            .dot-flashing::before, .dot-flashing::after {
                content: '';
                display: inline-block;
                position: absolute;
                top: 0;
            }
            .dot-flashing::before {
                left: -12px;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: #3b82f6;
                color: #3b82f6;
                animation: dotFlashing 1s infinite alternate;
                animation-delay: .2s;
            }
            .dot-flashing::after {
                left: 12px;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: #3b82f6;
                color: #3b82f6;
                animation: dotFlashing 1s infinite alternate;
                animation-delay: .4s;
            }
            @keyframes dotFlashing {
                0% {
                    background-color: #3b82f6;
                }
                50%,
                100% {
                    background-color: #e0e7ff; /* Tailwind blue-100 */
                }
            }
        `;
        document.head.appendChild(style);

        // Ensure speech synthesis is stopped if the user navigates away or closes the tab
        window.addEventListener('beforeunload', () => {
            if (synth.speaking) {
                synth.cancel();
            }
        });
    </script>
</body>
</html>